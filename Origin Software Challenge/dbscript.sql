IF(NOT EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME LIKE 'Card'))
BEGIN
	CREATE TABLE [Card](
		[IdCard] INT IDENTITY(1,1) NOT NULL,
		[CardNumber] VARCHAR(16) NOT NULL,
		[Pin] NVARCHAR(4) NOT NULL,
		[Balance] FLOAT NOT NULL,
		[Blocked] BIT NOT NULL,
		[FailedAttemps] INT NOT NULL,
		[ExpiryDate] DATE NOT NULL,
		CONSTRAINT [PK_Card] PRIMARY KEY CLUSTERED ([IdCard] ASC)
	) ON [PRIMARY]
END
GO

IF(NOT EXISTS(SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME LIKE 'Transaction'))
BEGIN
	CREATE TABLE [Transaction](
		[IdTransaction] INT IDENTITY(1,1) NOT NULL,
		[Code] NVARCHAR(50) NOT NULL,
		[CreationDate] DATETIME NOT NULL,
		[Withdraw] FLOAT NULL,
		[TransactionType] INT NOT NULL,
		[IdCard] INT NOT NULL,
		CONSTRAINT [PK_Transaction] PRIMARY KEY CLUSTERED ([IdTransaction] ASC)
	) ON [PRIMARY]

	ALTER TABLE [dbo].[Transaction]
	ADD CONSTRAINT [FK_Transaction_Card]
	FOREIGN KEY ([IdCard])
	REFERENCES [dbo].[Card] ([IdCard])

END
GO

IF(NOT EXISTS(SELECT * FROM [dbo].[Card] WHERE [CardNumber] LIKE '4561789412344562' ))
BEGIN
	INSERT INTO [dbo].[Card]
		([CardNumber],[Pin],[Balance],[Blocked],[FailedAttemps],[ExpiryDate])
	VALUES
		('4561789412344562', '1234', 250, 0, 0, '2025-07-01'),
		('4561789412397877', '6788', 15, 0, 0, '2025-07-01'),
		('4561789412369346', '7897', 23, 0, 0, '2025-07-01'),
		('4561789412334687', '7788', 3000, 0, 0, '2021-07-01'),
		('4561789412355642', '8542', 900, 0, 0, '2025-07-01'),
		('4561789412334678', '9845', 255, 0, 0, '2025-07-01'),
		('4561789412399875', '3569', 10, 0, 0, '2025-07-01')
END
GO